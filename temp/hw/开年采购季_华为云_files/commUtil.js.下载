define("base/utils/commUtil",["language/resource","base/utils/cookie","base/utils/CbcHttpService","base/js/GData"],function(i18n,cookieOp,CbcHttpService,GData){function getUrlParams(){var index,key,value,urlParams={},searchStr=window.location.search.substring(1),params=searchStr.split("&");for(index=0;index<params.length;index++){key=params[index].substring(0,params[index].indexOf("="));value=params[index].substring(params[index].indexOf("=")+1);urlParams[key]=decodeURIComponent(value)}return urlParams}function getParamFromUrl(url){var searchStr,params,index,key,value,urlParams={};try{if(!url)return urlParams;searchStr=url.split("?")[1];params=searchStr.split("&");for(index=0;index<params.length;index++){key=params[index].substring(0,params[index].indexOf("="));value=params[index].substring(params[index].indexOf("=")+1);urlParams[key]=decodeURIComponent(value)}return urlParams}catch(e){return urlParams}}function getFromacct(){var fromacct=getUrlParams().fromacct;void 0!=fromacct&&""!=fromacct||(fromacct=cookieOp.getCookie("h_fromacct"));return fromacct}function i18nFormat(){var regex,args;if(1===arguments.length)return arguments[0];regex=/{\d+}/g;args=arguments;return args[0].replace(regex,function(m,i){var index=parseInt(m.substr(1,m.length-1))+1;return void 0!=args[index]?args[index]:m})}function getPwdStrengthLevel(pwd){function charMode(iN){if(iN>=48&&iN<=57)return 1;if(iN>=65&&iN<=90)return 2;return iN>=97&&iN<=122?4:8}function bitTotal(num){var k,modes1=0;for(k=0;k<4;k++){1&num&&modes1++;num>>>=1}return modes1}function getLevel(allBits){switch(allBits){case 4:case 3:return"high";case 2:return"mid";case 1:default:return"low"}}var i,modes=0;for(i=0;i<pwd.length;i++)modes|=charMode(pwd.charCodeAt(i));return getLevel(bitTotal(modes))}function buildPasswordTip(number,chars,maxSameChars,notEqualName,notContsMobile){var tip="<div style='font-size:12px;font-family:Arial;color:#050505;margin: 5px 0 5px 10px;'><img id='minLenId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+number+"</div><img id='containsCharsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+chars+"</div>";maxSameChars&&(tip=tip+"<img id='maxSameCharsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div id='maxSameCharsLabel' class='tootip-div'>"+maxSameChars+"</div>");notEqualName&&(tip=tip+"<img id='notNameId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+notEqualName+"</div>");notContsMobile&&(tip=tip+"<img id='notContsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+notContsMobile+"</div>");tip=tip+"<div ><div  style='display:inline-block;margin-left:-22px'><span style='float:right' id='strengthflag'></span><span id='strengthHigh' class='passwordStrength'></span><span id='strengthMid' class='passwordStrength'></span><span id='strengthLow'  class='passwordStrength'></span><span style='display: inline-block;float:left;margin-left:27px;'>"+i18n("safetyDegree")+"</span></div></div></div>";return tip}function buildUniPasswordTip(number,chars,maxSameChars,notEqualName,notContsMobile,notContsBlank){var tip="<div style='font-size:12px;font-family:Arial;color:#050505;margin: 5px 0 5px 10px;'><img id='minLenId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+number+"</div><img id='containsCharsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+chars+"</div>";maxSameChars&&(tip=tip+"<img id='maxSameCharsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div id='maxSameCharsLabel' class='tootip-div'>"+maxSameChars+"</div>");notEqualName&&(tip=tip+"<img id='notNameId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+notEqualName+"</div>");notContsMobile&&(tip=tip+"<img id='notContsId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+notContsMobile+"</div>");notContsBlank&&(tip=tip+"<img id='notBeginAndEndBlankId' class='tootip-img' src='//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png'></img>&nbsp;&nbsp;<div class='tootip-div'>"+notContsBlank+"</div>");tip=tip+"<div ><div  style='display:inline-block;margin-left:-22px'><span style='float:right' id='strengthflag'></span><span id='strengthHigh' class='passwordStrength'></span><span id='strengthMid' class='passwordStrength'></span><span id='strengthLow'  class='passwordStrength'></span><span style='display: inline-block;float:left;margin-left:27px;'>"+i18n("safetyDegree")+"</span></div></div></div>";return tip}function checkPassword(pwd,policy){var pwdPolicy=policy.passwordpolicy,retObj=notBlank(pwd,!1);if(!retObj.result){retObj.cases="not-blank";return retObj}retObj=minLen(pwd,pwdPolicy.password_minlen);if(!retObj.result){retObj.cases="min-len";return retObj}retObj=maxLen(pwd,pwdPolicy.password_maxlen);if(!retObj.result){retObj.cases="max-len";return retObj}return retObj}function validatePasswdCharPlus(value){var number,spec;if(!/[a-zA-Z]/.exec(value))return!1;number=/[0-9]/;if(!number.exec(value))return!1;spec=/[~`\!\?,\.\:;\-_\'\"\(\)\{\}\[\]\/@#$%\^&*+\|\\\=<>]/;if(!spec.exec(value))return!1;return!0}function maxLen(value,maxLen){var maxLenNum=Number(maxLen);isNaN(maxLenNum)&&(maxLenNum=255);return getRetObj(value.length>maxLenNum?!1:!0)}function minLen(value,minLen){var minLenNum=Number(minLen);isNaN(minLenNum)&&(minLenNum=0);return getRetObj(value.length<minLenNum?!1:!0)}function notBlank(value,notContainSpace){if(void 0===value||0===value.length)return getRetObj(!1);if(notContainSpace&&-1!==value.indexOf(" "))return getRetObj(!1);return getRetObj(!0)}function getRetObj(result){return{"result":result}}function createTipDiv(tipInfo){var tipDiv='<p id="TipDiv" style="background: rgba(0, 0, 0, 0.8);text-align: center;padding:10px 10px;color: #fff;z-index: 9999;position: absolute;margin-left: 4%;top: 40%;-webkit-border-radius: 2px;width: 92%;font-size: 16px;">'+tipInfo+"</p>";$("#TipDiv").remove();$(document.body).append(tipDiv)}function queryVoiceVerifyCodeSwitch($scope){setTimeout(function(){$scope.fVoiceCerificationCode=CbcHttpService.queryConfigItem("CBCCustomerRegService","switch-config","fVoiceCerificationCode","off");var isGrayCookie=getCookieValue("isGray");"product"===$scope.fVoiceCerificationCode?$scope.sendCodeType=isGrayCookie?GData.CONST.CODE_TYPE_SMS:GData.CONST.CODE_TYPE_VOICE:"gray"===$scope.fVoiceCerificationCode?$scope.sendCodeType=isGrayCookie?GData.CONST.CODE_TYPE_VOICE:GData.CONST.CODE_TYPE_SMS:"all"===$scope.fVoiceCerificationCode?$scope.sendCodeType=GData.CONST.CODE_TYPE_VOICE:$scope.sendCodeType=GData.CONST.CODE_TYPE_SMS;$scope.model.msgBtnTxt=i18n($scope.sendCodeType==GData.CONST.CODE_TYPE_SMS?"msgCodeTxt":"msgVoiceCodeTxt");$scope.model.msgBtnOriTxt=$scope.model.msgBtnTxt;$scope.model.msgCodePlaceHolder=i18n($scope.sendCodeType==GData.CONST.CODE_TYPE_SMS?"register.msgCodePlaceHolder":"register.msgVoiceCodePlaceHolder");$scope.$apply()},0)}function getUniRegisterSwitch(){var hwid_gray,switch_hwid=!1,switchVal=CbcHttpService.queryConfigItem("CBCCustomerRegService","uniportal-config","HWID_REGISTER_SWITCH","off");if(switchVal&&"gray_on"==switchVal){hwid_gray=getCookieValue("hwid_gray");hwid_gray&&"true"==hwid_gray&&(switch_hwid=!0)}else switch_hwid=!(!switchVal||"on"!=switchVal);return switch_hwid}return{"initBpInvitedInfo":function($scope,isHandleCookie){var isBpInvite,service,inviteCode,bpName,bindType,cooperateSourceID,url_args,hw_abi,abiJson;$scope.bp={"bpName":"","bindType":"","salesID":"","referUrl":"","campaignID":"","showName":"","chkChange":function(){"function"==typeof onAgreeBindBpClick&&onAgreeBindBpClick($scope.bp.isBindBp)},"isBindBp":!1,"isForceBindBp":!1,"isShowBindTip":!1,"isShowBpNotice":!1,"bindBpTip":""};isBpInvite=!!getUrlParams().bpInvite;service=getUrlParams().service;if(isBpInvite){$scope.bindBpUrl=getUrlParams().service;void 0===$scope.bindBpUrl&&($scope.isMobileWeb?$scope.bindBpUrl=$scope.url.usercenter.mobile_regSuc:$scope.bindBpUrl=$scope.url.usercenter.regSuc);inviteCode=getUrlParams().inviteCode;bpName=getUrlParams().bpName;bindType=getUrlParams().bindType;cooperateSourceID=getUrlParams().campaignID;url_args="";url_args+=inviteCode?"&inviteCode="+inviteCode:"";url_args+=bpName?"&bpName="+bpName:"";url_args+=bindType?"&bindType="+bindType:"";url_args+=cooperateSourceID?"&cooperateSourceID="+cooperateSourceID:"";-1===$scope.bindBpUrl.indexOf("?")&&url_args.length>0&&(url_args="?"+url_args.substr(1));$scope.bindBpUrl+=url_args;$scope.bp.isBindBp=!0;return!0}if(!1===isHandleCookie)return!1;hw_abi=cookieOp.getCookie("hw_abi");if(hw_abi){abiJson=JSON.parse(hw_abi);if(abiJson){$scope.bp.bpName=abiJson.n;$scope.bp.bindType=abiJson.t;if(!$scope.bp.bpName||!$scope.bp.bindType)return!1;$scope.bp.referUrl=abiJson.url;$scope.bp.salesID=abiJson.sid;$scope.bp.campaignID=abiJson.campaignID;$scope.bp.isShowBindTip=!0;$scope.bp.isBindBp=!0;$scope.bp.isShowBpNotice=2===$scope.bp.bindType||3===$scope.bp.bindType;CbcHttpService.queryBpRealName($scope);$scope.bp.bindBpTip=i18nFormat(i18n("bindBpTip"),$scope.bp.showName);$scope.isMobileWeb?$scope.bindBpUrl=$scope.url.usercenter.mobile_regSuc:$scope.bindBpUrl=$scope.url.usercenter.regSuc;$scope.bindBpUrl+="&bpName="+$scope.bp.bpName+"&bindType="+$scope.bp.bindType;$scope.bp.campaignID&&($scope.bindBpUrl+="&cooperateSourceID="+$scope.bp.campaignID);$scope.bp.salesID&&($scope.bindBpUrl+="&inviteCode="+$scope.bp.salesID);service&&($scope.bindBpUrl+="&url="+encodeURIComponent(service));$scope.bp.referUrl&&document.referrer&&decodeURIComponent(document.referrer).indexOf($scope.bp.referUrl)>-1&&($scope.bp.isForceBindBp=!0);return!0}}return!1},"sendVerifyCode":function($scope){if(!$scope.model.checkPhoneOrEmail())return;$("#msgBtn").addClass("msgBtnDisabled");var uorExtParams=$scope.model.buildUorExtParams();onMsgCodeSend(!$scope.model.isEmailShow,"",uorExtParams);"GEE_TEST"===$scope.model.captchaType?$scope.model.captchaObj.verify():setTimeout(function(){"GEE_TEST"===$scope.model.captchaType?$scope.model.captchaObj.verify():$scope.model.sendMsgCode()},1e3)},"maskMobile":function(mobile){-1!==mobile.indexOf("-")&&(mobile=mobile.substring(mobile.indexOf("-")+1));if(""===mobile||void 0===mobile)return"";if(mobile.length>7)return mobile.substr(0,3)+"****"+mobile.substr(7,mobile.length);if(mobile.length>3)return mobile.substr(0,3)+"****";return mobile+"****"},"maskEmail":function(email){var pair,pref,len,beginString,endString,maskEmail;if(!email)return"******";if(-1===email.indexOf("@"))return"******";pair=email.split("@");if(2!==pair.length)return"******";pref=pair[0];len=pref.length;beginString=len<2?pref:pref.substring(0,1);endString=len>2?pref.substring(len-1,len):"";maskEmail="";2===len||3===len?maskEmail="*":4===len?maskEmail="**":len>4&&(maskEmail="***");return beginString+maskEmail+endString+"@"+pair[1]},"handleExtParams":function($scope){var abiJson,traceId,campaignID,traceTemp,hw_abi=cookieOp.getCookie("hw_abi");if(hw_abi){abiJson=JSON.parse(hw_abi);if(abiJson)if($scope.bp&&$scope.bp.isBindBp){traceId=abiJson.n+"_";campaignID=abiJson.campaignID;campaignID&&(traceId=traceId+"_"+campaignID);if($scope.model.extParams.length>0){traceTemp=!1;$scope.model.extParams.forEach(function(item){"traceId"===item.key&&(traceTemp=!0)});!traceTemp&&$scope.model.extParams.push({"key":"visitUrl","value":window.location.href},{"key":"traceId","value":traceId},{"key":"campaignID","value":campaignID})}else $scope.model.extParams.push({"key":"visitUrl","value":window.location.href},{"key":"traceId","value":traceId},{"key":"campaignID","value":campaignID})}else $scope.model.extParams.length>0&&$scope.model.extParams.forEach(function(item){"traceId"!==item.key&&"visitUrl"!==item.key&&"campaignID"!==item.key||$scope.model.extParams.splice(item)})}},"i18nFormat":i18nFormat,"getUrlParams":getUrlParams,"getParamFromUrl":getParamFromUrl,"getPwdStrengthLevel":getPwdStrengthLevel,"buildPasswordTip":buildPasswordTip,"buildUniPasswordTip":buildUniPasswordTip,"checkPassword":checkPassword,"validatePasswdCharPlus":validatePasswdCharPlus,"createTipDiv":createTipDiv,"queryVoiceVerifyCodeSwitch":queryVoiceVerifyCodeSwitch,"getUniRegisterSwitch":getUniRegisterSwitch,"getFromacct":getFromacct}});