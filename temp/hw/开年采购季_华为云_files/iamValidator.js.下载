define(["base/utils/utility"],function(utils){"user strict";function IAMValidator(i18n){this.i18n=i18n;this.directValidator=new DirectValidator(i18n)}function DirectValidator(i18n){this.i18n=i18n}function getRetObj(result,err){return{"result":result,"errorInfo":err}}function searchMaxString(origString){var i,j,stringLen=origString.length,maxLength=1,index=1,flagChar=origString.charAt(0);for(i=0;i<stringLen;){index=1;for(j=i+1;j<stringLen&&flagChar==origString.charAt(j);j++)index++;index>maxLength&&(maxLength=index);i=j;flagChar=origString.charAt(i)}return maxLength}IAMValidator.prototype.notBlank=function(cannotContainBlank){var i18n=this.i18n;return{"validFn":function(){var value=this.val();if(void 0!==cannotContainBlank&&cannotContainBlank){if(void 0==value||0===value.length||-1!==value.toString().indexOf(" "))return i18n("emptyTxt");return""}if(void 0==value||0===value.length)return i18n("blankTxt");return""}}};IAMValidator.prototype.maxLen=function(maxLen,errorDetail){var i18n=this.i18n,maxLenNum=Number(maxLen);isNaN(maxLenNum)&&(maxLenNum=255);void 0===errorDetail&&(errorDetail=i18n("maxLenTxt"));return{"validFn":"maxSize","params":[maxLenNum],"errorDetail":utils.i18nFormat(errorDetail,maxLenNum)}};IAMValidator.prototype.minLen=function(minLen,errorDetail){var i18n=this.i18n,minLenNum=Number(minLen);isNaN(minLenNum)&&(minLenNum=0);void 0===errorDetail&&(errorDetail=i18n("minLenTxt"));return{"validFn":"minSize","params":[minLenNum],"errorDetail":utils.i18nFormat(errorDetail,minLenNum)}};IAMValidator.prototype.validInput=function(regExpStr,errorDetail){return{"validFn":function(){var pattern,value=this.val();if(void 0===value||""===value)return!0;pattern=new RegExp(regExpStr);return pattern.test(value)},"errorDetail":errorDetail}};IAMValidator.prototype.notEqualOrInvert=function(compareId,errorDetail){return{"validFn":function(params){var userNameWidget,pwd,userName="";try{userNameWidget=$("#"+params[0]).widget();if(userNameWidget)userName=userNameWidget.getValue();else try{userName=$("#"+params[0])[0].innerHTML}catch(e){userName=compareId}}catch(ex){userName=compareId}pwd=this.val();if(userName.toLowerCase()===pwd.toLowerCase())return!1;if(pwd.toLowerCase()===userName.split("").reverse().join("").toLowerCase())return!1;return!0},"params":[compareId],"errorDetail":errorDetail}};IAMValidator.prototype.equal=function(compareId,errorDetail){return{"validFn":function(params){return $("#"+params[0]).widget().getValue()===this.val()},"params":[compareId],"errorDetail":errorDetail}};IAMValidator.prototype.unequal=function(compareId,errorDetail){return{"validFn":function(params){return $("#"+params[0]).widget().getValue()!==this.val()},"params":[compareId],"errorDetail":errorDetail}};IAMValidator.prototype.pwdLevelCheck=function(){var i18n=this.i18n;return{"validFn":function(){var pwd=this.val(),strengthLevel=utils.getPwdStrengthLevel(pwd);return"high"===strengthLevel||"mid"===strengthLevel},"errorDetail":i18n("passwordChars")}};IAMValidator.prototype.emailCheck=function(){return{"validFn":"email","errorDetail":(0,this.i18n)("validEmail")}};IAMValidator.prototype.checkCountryCode=function(codeArray,errorDetail){return{"validFn":function(){var i,value=this.val();if(void 0===value||""===value)return!0;for(i=0;i<codeArray.length;i++)if(value===codeArray[i])return!0;return!1},"errorDetail":errorDetail}};IAMValidator.prototype.checkCharLength=function(maxLen){var i18n=this.i18n;return{"validFn":function(){var i,value=this.val(),charLength=0;for(i=0;i<value.length;i++)value.charCodeAt(i)>=0&&value.charCodeAt(i)<=255?charLength+=1:charLength+=2;if(charLength>maxLen)return!1;return!0},"errorDetail":utils.i18nFormat(i18n("maxLenTxt"),maxLen)}};IAMValidator.prototype.phoneCheck=function(){var i18n=this.i18n;return{"validFn":function(){return/^[0-9]\d*$/.test(this.val())},"errorDetail":i18n("validPhone")}};IAMValidator.prototype.phoneAddCheck=function(){var i18n=this.i18n;return{"validFn":function(){return/^1\d{10}$/.test(this.val())},"errorDetail":i18n("validPhone")}};IAMValidator.prototype.msgCodeCheck=function(){var i18n=this.i18n;return{"validFn":function(){return/^[a-zA-Z0-9]*$/.test(this.val())},"errorDetail":i18n("commonContainsChar")}};IAMValidator.prototype.smsMsgCodeCheck=function(){var i18n=this.i18n;return{"validFn":function(){return/^[0-9]*$/.test(this.val())},"errorDetail":i18n("msgCodeErrorInfo")}};IAMValidator.prototype.limitLength=function(length){return{"validFn":function(){var value=this.val();if(void 0===value)return!0;value=value.toString();value.length>length&&this.val(value.substring(0,length));return!0}}};IAMValidator.prototype.maxRptCharTimes=function(numOfRptCharInPwd){var i18n=this.i18n;return{"validFn":function(){var value=this.val();if(void 0===value||0===numOfRptCharInPwd)return!0;value=value.toString();if(searchMaxString(value)>numOfRptCharInPwd)return!1;return!0},"errorDetail":utils.i18nFormat(i18n("passwordPolicy.errorMsgOfRptChar"),numOfRptCharInPwd)}};IAMValidator.prototype.getCompoundValidator=function(){var me=this;return{"required":function(){return[me.notBlank()]},"notBlank":function(cannotContainBlank){return me.notBlank(cannotContainBlank)},"maxLen":function(maxLen,errorDetail){return[me.maxLen(maxLen,errorDetail)]},"minLen":function(minLen){return[me.minLen(minLen)]},"commonValidInput":function(){return[me.limitLength(255),me.validInput("^[一-龥a-zA-Z0-9\\_\\- ]+$",me.i18n("commonContainsChar")),me.maxLen(255)]},"name":function(policy){var accountPolicy=policy.accountpolicy,minLength=username_minlen,maxLength=username_maxlen;return[me.limitLength(128),me.notBlank(!0),me.validInput(accountPolicy.username_contains_char,me.i18n("nameContainsChar")),me.minLen(minLength),me.maxLen(maxLength)]},"password":function(policy,userNameId,pwdMinLen,numOfRptCharInPwd,oldpwdId){var pwdPolicy=policy.passwordpolicy,validators=[me.notBlank(!1),me.minLen(pwdMinLen),me.maxRptCharTimes(numOfRptCharInPwd),me.maxLen(pwdPolicy.password_maxlen)];userNameId&&"true"===pwdPolicy.pwd_not_is_the_username_or_invert&&validators.push(me.notEqualOrInvert(userNameId,me.i18n("pwdNotUsernameOrInvert")));oldpwdId&&validators.push(me.unequal(oldpwdId,me.i18n("pwdSame")));validators.push(me.pwdLevelCheck());validators.unshift(me.limitLength(33));return validators},"email":function(){return[me.limitLength(300),me.notBlank(!0),me.emailCheck(),me.maxLen(255),me.checkCharLength(255)]},"phone":function(phoneLen){return[me.limitLength(128),me.notBlank(!0),me.phoneCheck(),me.maxLen(phoneLen,me.i18n("phoneMaxLenTxt"))]},"phoneAdd":function(){return[me.limitLength(11),me.notBlank(!0),me.phoneAddCheck(),me.maxLen(11,me.i18n("phoneMaxLenTxt"))]},"countryCode":function(codeArray){return[me.limitLength(128),me.notBlank(),me.checkCountryCode(codeArray,me.i18n("inValidCountryCode"))]},"passwordLevel":function(lowId,midId,highId){return utils.pwdLevel4Display(lowId,midId,highId)},"confirmPwd":function(pwdId){return[me.limitLength(33),me.notBlank(),me.equal(pwdId,me.i18n("passwordEqual"))]},"msgCode":function(){return[me.limitLength(8),me.notBlank(!0),me.msgCodeCheck(),me.maxLen(8,me.i18n("maxLenTxt"))]},"smsMsgCode":function(){return[me.limitLength(6),me.notBlank(!0),me.smsMsgCodeCheck(),me.maxLen(6,me.i18n("maxLenTxt"))]},"graphVerifyCode":function(){return[me.limitLength(4),me.notBlank(),me.maxLen(4)]},"childValidator":me}};IAMValidator.prototype.getCompoundDirectValidator=function(){var me=this,dv=me.directValidator;return{"required":function(value){return dv.notBlank(value)},"notBlank":function(value,cannotContainBlank){return dv.notBlank(value,cannotContainBlank)},"notEmpty":function(value,cannotContainBlank){return dv.notEmpty(value,cannotContainBlank)},"maxLen":function(value,maxLen,errorDetail){return dv.maxLen(value,maxLen,errorDetail)},"minLen":function(value,minLen){return dv.minLen(value,minLen)},"commonValidInput":function(value){var retObj=dv.validInput(value,"^[一-龥a-zA-Z0-9\\_\\- ]+$",me.i18n("commonContainsChar"));if(!retObj.result)return retObj;retObj=dv.maxLen(value);return retObj},"name":function(value,policy){var minLength,maxLength,retObj=dv.notBlank(value,!1);if(!retObj.result)return retObj;retObj=dv.validInput(value,"^[a-zA-Z\\_\\- ][0-9a-zA-Z\\_\\- ]*$",me.i18n("nameContainsChar"));if(!retObj.result)return retObj;minLength=username_minlen;maxLength=username_maxlen;minLength<1&&(minLength=1);maxLength>64&&(maxLength=64);retObj=dv.minLen(value,minLength);if(!retObj.result)return retObj;retObj=dv.maxLen(value,maxLength);return retObj},"password":function(pwd,policy,userNameId,pwdMinLen){var pwdPolicy=policy.passwordpolicy,retObj=dv.notBlank(pwd,!1);if(!retObj.result){retObj.cases="not-blank";return retObj}retObj=dv.minLen(pwd,pwdMinLen||pwdPolicy.password_minlen);if(!retObj.result){retObj.cases="min-len";return retObj}retObj=dv.maxLen(pwd,pwdPolicy.password_maxlen);if(!retObj.result){retObj.cases="max-len";return retObj}if(userNameId&&"true"===pwdPolicy.pwd_not_is_the_username_or_invert){retObj=dv.notEqualOrInvert(pwd,userNameId,me.i18n("pwdNotUsernameOrInvert"));if(!retObj.result){retObj.cases="conf-name";return retObj}}return retObj},"email":function(value){var retObj=dv.notEmpty(value,!0);if(!retObj.result)return retObj;retObj=dv.emailCheck(value);if(!retObj.result)return retObj;retObj=dv.checkCharLength(value,255);if(!retObj.result)return retObj;retObj=dv.maxLen(value,255);return retObj},"phone":function(value,phoneLen){var length,retObj=dv.notEmpty(value,!0);if(!retObj.result)return retObj;retObj=dv.phoneCheck(value);if(!retObj.result)return retObj;length=phoneLen||32;retObj=dv.maxLen(value,length,me.i18n("phoneMaxLenTxt"));return retObj},"phoneAdd":function(value){var retObj=dv.notEmpty(value,!0);if(!retObj.result)return retObj;retObj=dv.phoneAddCheck(value);if(!retObj.result)return retObj;retObj=dv.maxLen(value,11,me.i18n("phoneMaxLenTxt"));return retObj},"confirmPwd":function(value,pwdId){var retObj=dv.notBlank(value,!1);if(!retObj.result)return retObj;retObj=dv.equal(value,pwdId,me.i18n("passwordEqual"));return retObj},"msgCode":function(value){var retObj=dv.notEmpty(value,!0);if(!retObj.result)return retObj;retObj=dv.msgCodeCheck(value);if(!retObj.result)return retObj;retObj=dv.maxLen(value,8,me.i18n("maxLenTxt"));return retObj},"smsMsgCode":function(value){var retObj=dv.notEmpty(value,!0);if(!retObj.result)return retObj;retObj=dv.smsMsgCodeCheck(value);if(!retObj.result)return retObj;retObj=dv.maxLen(value,6,me.i18n("maxLenTxt"));return retObj},"graphVerifyCode":function(value){var retObj=dv.notBlank(value,!0);if(!retObj.result)return retObj;retObj=dv.maxLen(value,4);return retObj},"childValidator":me.directValidator}};DirectValidator.prototype.notBlank=function(value,notContainSpace){if(void 0===value||0===value.length)return getRetObj(!1,this.i18n("blankTxt"));if(notContainSpace&&-1!==value.indexOf(" "))return getRetObj(!1,this.i18n("emptyTxt"));return getRetObj(!0)};DirectValidator.prototype.notEmpty=function(value,notContainSpace){if(notContainSpace&&(void 0===value||-1!==value.indexOf(" ")||0===value.length))return getRetObj(!1,this.i18n("emptyTxt"));if(!value||0===$.trim(value.toString()).length)return getRetObj(!1,this.i18n("blankTxt"));return getRetObj(!0)};DirectValidator.prototype.maxLen=function(value,maxLen,errorDetail){var maxLenNum=Number(maxLen);isNaN(maxLenNum)&&(maxLenNum=255);errorDetail||(errorDetail=this.i18n("maxLenTxt"));return value.length>maxLenNum?getRetObj(!1,utils.i18nFormat(errorDetail,maxLenNum)):getRetObj(!0)};DirectValidator.prototype.minLen=function(value,minLen,errorDetail){var minLenNum=Number(minLen);isNaN(minLenNum)&&(minLenNum=0);errorDetail||(errorDetail=this.i18n("minLenTxt"));return value.length<minLenNum?getRetObj(!1,utils.i18nFormat(errorDetail,minLenNum)):getRetObj(!0)};DirectValidator.prototype.validInput=function(value,regExpStr,errorDetail){var pattern,result;if(!value)return getRetObj(!0);pattern=new RegExp(regExpStr);result=pattern.test(value);return result?getRetObj(!0):getRetObj(!1,errorDetail)};DirectValidator.prototype.notEqualOrInvert=function(value,compareId,errorDetail){var targetWidget,targetValue="";try{targetWidget=$("#"+compareId).widget()}catch(e){targetValue=compareId}if(targetWidget)targetValue=targetWidget.getValue();else if(""===targetValue){targetValue=$("#"+compareId).html();targetValue||(targetValue=compareId)}if(value&&(value.toLowerCase()===targetValue.toLowerCase()||value.toLowerCase()===targetValue.split("").reverse().join("").toLowerCase()))return getRetObj(!1,errorDetail);return getRetObj(!0)};DirectValidator.prototype.equal=function(value,compareId,errorDetail){if($("#"+compareId).widget().getValue()!==value)return getRetObj(!1,errorDetail);return getRetObj(!0)};DirectValidator.prototype.emailCheck=function(value){return/^((([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/.test(value)?getRetObj(!0):getRetObj(!1,this.i18n("validEmail"))};DirectValidator.prototype.phoneCheck=function(value){return/^[0-9]\d*$/.test(value)?getRetObj(!0):getRetObj(!1,this.i18n("validPhone"))};DirectValidator.prototype.phoneAddCheck=function(value){return/^1\d{10}$/.test(value)?getRetObj(!0):getRetObj(!1,this.i18n("validPhone"))};DirectValidator.prototype.checkCharLength=function(value,maxLen){var i,charLength=0;for(i=0;i<value.length;i++)value.charCodeAt(i)>=0&&value.charCodeAt(i)<=255?charLength+=1:charLength+=2;return charLength>maxLen?getRetObj(!1,utils.i18nFormat(this.i18n("maxLenTxt"),maxLen)):getRetObj(!0)};DirectValidator.prototype.msgCodeCheck=function(value){return/^[a-zA-Z0-9]*$/.test(value)?getRetObj(!0):getRetObj(!1,this.i18n("commonContainsChar"))};DirectValidator.prototype.smsMsgCodeCheck=function(value){return/^[0-9]*$/.test(value)?getRetObj(!0):getRetObj(!1,this.i18n("msgCodeErrorInfo"))};return IAMValidator});