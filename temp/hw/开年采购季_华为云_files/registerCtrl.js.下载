define("//res.hc-cdn.com/register/6.2.209/registerui/cn/iframe/controllers/registerCtrl.js",["language/resource","base/js/iamUtils","base/utils/cookie","base/utils/utility","base/utils/commUtil","base/utils/iamHttpService","base/utils/CbcHttpService","base/widgets/verifyWindow/verifyWindow","base/js/GData"],function(i18n,iamUtils,cookieOp,utils,commUtil,iamHttpService,CbcHttpService,verifyWindow,GData){"use strict";function CustomerRegisterController($scope,securityPolicy,$compile,tiValid,tiMessage,tiModal,tiTipService){function changePwd(pwd,isUniRegister){return checkPwdVal(pwd,isUniRegister)}function checkPwdVal(pwd,isUniRegister){var level=commUtil.getPwdStrengthLevel(pwd);if(null!=level&&(!isUniRegister&&("high"===level||"mid"===level)||isUniRegister&&"high"===level)){$("#PWD_C2").attr("src","//res.hc-cdn.com/register/6.2.209/registerui/theme/img/valid-ye.png");return!0}$("#PWD_C2").attr("src","//res.hc-cdn.com/register/6.2.209/registerui/theme/img/valid-no.png");return!1}function passwordTipContent(){return utils.buildPasswordTip(utils.i18nFormat(i18n("minMaxLenTxt"),securityPolicy.passwordpolicy.password_minlen,securityPolicy.passwordpolicy.password_maxlen),i18n("passwordChars"),null,null,i18n("pwdNotContsMobile"),i18n,$scope.isUniRegister?i18n("pwdNotBeginAndEndBlank"):null)}function passwordTipContentWithName(){return utils.buildPasswordTip(utils.i18nFormat(i18n("minMaxLenTxt"),securityPolicy.passwordpolicy.password_minlen,securityPolicy.passwordpolicy.password_maxlen),i18n("passwordChars"),null,i18n("pwdNotUsernameOrInvert"),i18n("pwdNotContsMobile"),i18n,$scope.isUniRegister?i18n("pwdNotBeginAndEndBlank"):null)}function checkPhoneExist(){$scope.model.sceneType="register_portal";CbcHttpService.checkIdentity($scope,GData.CONST.IDENTIFY_TYPE_PHONE,"0086-"+$scope.model.phone,function(data){window.hwcap&&window.hwcap.reload();var checkResult="noExist";if(data&&"true"===data.canUse){checkResult="false"===data.identityUsed?"noExist":"existCanUse";showOkImg($scope.model.phoneId,"#phoneRight")}else{if(data.reason&&"PHONE_NUM_ONLY_ONE"===data.reason){errorWithoutMessage($scope.model.phoneId,"phoneRight");$("#areaCode").addClass("ti-validate-error")}else{errorWithoutMessage($scope.model.phoneId,"phoneRight");$("#areaCode").addClass("ti-validate-error")}checkResult="confirmLogin"}if("existCanUse"===checkResult){$scope.model.showAccountName=!0;$scope.model.passwordTip.content=passwordTipContentWithName();$("#companyAccountName").show();document.getElementById("phoneRepeatInfo").style.display="block";$("#pwdTip").removeClass("pwdTip");$("#pwdTip").addClass("pwdTipChangeAccount");$scope.isAccount=!0;return!0}if("noExist"===checkResult){if(void 0==$scope.model.accountName||null==$scope.model.accountName||""==$scope.model.accountName){$scope.model.showAccountName=!1;$scope.model.passwordTip.content=passwordTipContent();$("#companyAccountName").hide()}return!0}if("confirmLogin"===checkResult){$("#areaCode").addClass("ti-validate-error");errorWithoutMessage($scope.model.phoneId,"phoneRight");document.getElementById("phoneOverLimitInfo").style.display="block";return!1}if("noUse"===checkResult)return!1;return!0},function(err){})}function isKeyExisted($scope,iamHttpService,type,value,errorTxt,txtFielId,errorInfoid,testBlank){iamHttpService.post({"url":"/registerui/rest/cbc/cbccustomerregservice/v1/account/check_identity","contentType":"application/json; charset=UTF-8","params":JSON.stringify({"identityType":type&&"phone"===type?"MOBILE_PHONE":"DOMAIN_NAME","identityValue":value,"scenceType":"register_portal","accountType":$scope.isUniRegister?"UNIPORTAL":"","areaCode":"CN","clientInfo":{"devId":cookieOp.get_cookie("cbc-sid")?cookieOp.get_cookie("cbc-sid"):"","hwMeta":$("#hwmeta").val()?$("#hwmeta").val():""}})}).then(function(data){window.hwcap&&window.hwcap.reload();data&&"false"===data.canUse?addErrorInfo(errorTxt,txtFielId,errorInfoid):showOkImg(txtFielId,"#accountRight")},function(){showOkImg(txtFielId,"#accountRight")});testBlank||upToCloudBI(type,2,$scope.model.buildUorExtParams())}function getRegionCode(){var regions,i;$scope.model.regionValues=[];regions="zh-cn"===window.language?regionsZh:regionsEn;$scope.model.regionJson=regions;for(i in regions){if(!regions[i])continue;$scope.model.regionValues.push(regions[i])}}function buildHeight(){var $tar,MutationObserver,recordHeight,mutationObserver,dataValue={"messageType":"activity_iframe","function":{"name":"changeStyle","params":{"styles":{"width":"450","height":"441","scrolling":"no"}}}};window.parent.postMessage(dataValue,"*");$tar=document.getElementById("registerForm");MutationObserver=window.MutationObserver||window.webkitMutationObserver||window.MozMutationObserver;recordHeight=0;mutationObserver=new MutationObserver(function(mutations){var height=window.getComputedStyle($tar).getPropertyValue("height");if(height===recordHeight)return;dataValue.function.params.styles.height=height;window.parent.postMessage(dataValue,"*")});mutationObserver.observe($tar,{"childList":!0,"attributes":!0,"characterData":!0,"subtree":!0})}document.title=i18n("titles.register");$scope.i18n=i18n;$scope.url=GData.URL;$scope.sendCodeType=GData.CONST.CODE_TYPE_SMS;commUtil.queryVoiceVerifyCodeSwitch($scope);$scope.isUniRegister="undefined"!=typeof isUniRegister&&isUniRegister||commUtil.getUniRegisterSwitch();$scope.isUniRegister&&(securityPolicy.passwordpolicy.password_minlen=8);$scope.mobilePasswordTipIntl_length=i18n($scope.isUniRegister?"mobilePasswordTipiframe_length":"mobilePasswordTipIntl_length");$scope.showLearnMoreInfo=function(){$scope.model.showLearnMoreInfo=!$scope.model.showLearnMoreInfo;if($scope.model.showLearnMoreInfo){onLearnMoreBi(1);$("#triangleSign").css("transform","rotate(180deg)")}else{onLearnMoreBi(0);$("#triangleSign").css("transform","rotate(0deg)")}};$scope.phoneRepeatText=$scope.isUniRegister?$compile("<span>"+commUtil.i18nFormat(i18n("phoneHaveUniRegister"),'<a  ng-click="repeatPhoneLogin()">'+i18n("logInNow")+"</a>")+"</span>")($scope):$compile("<span>"+i18n("phoneHaveRegister")+'<a  ng-click="repeatPhoneLogin()" >'+i18n("logInNow")+"</a></span>")($scope);$scope.phoneOverLimitText=$scope.isUniRegister?$compile("<span>"+commUtil.i18nFormat(i18n("uniRegisterFailed.mobileOverLimit"),'<a ng-click="repeatPhoneLogin()">'+i18n("logInNow")+"</a>")+"</span>")($scope):$compile("<span>"+i18n("registerFailed.mobileOverLimit")+'<a  ng-click="repeatPhoneLogin()">'+i18n("logInNow")+"</a></span>")($scope);$scope.go2CreateHuaweiCloud=function(){var nextUrl="zh-cn"===window.language||"en-us"===window.language?"/registerui/cn/register.html?locale="+window.language:"/registerui/cn/register.html?locale=zh-cn";$scope.model.phone&&(nextUrl=nextUrl+"&locateType=mobile&locateId="+$scope.model.phone);window.location.href=nextUrl};$scope.model={"onMsgCodeFocus":function(){$("#msgCodeError").show()},"accountName":"","showAccountName":!1,"password":"","showLearnMoreInfo":!1,"confirmPassword":"","phone":"mobile"===iamUtils.getUrlParams().locateType?iamUtils.getUrlParams().locateId:"","panelHeight":"250px","msgCode":"","pageTitle":i18n("registerTitle_CN"),"pageTitleB":i18n("registerTitleB"),"pageTitleIframe":i18n($scope.isUniRegister?"hwIdPageTitleIframe":"pageTitleIframe"),"currentLanguage":window.language,"type":"password","submitType":"major","codeSelectId":"codeSelectId","regionSelectId":"regionSelectId","codeJson":"","codeArray":[],"regionValues":[],"regionJson":"","defaultCode":"0086","selectOption":{"zh-cn":[{"id":"0086","label":"+86（中国大陆）"}],"en-us":[{"id":"0086","label":"+86 (China)"}]}[window.language],"phoneLen":"","codeRegion":i18n("codeRegion"),"maxPwdLength":32,"phoneLenObj":"","regionCode":"","accountNameId":"accountNameId","registerEmailId":"registerEmailId","regionDefaultValues":i18n("register.regionSelect"),"passwordId":"passwordId","passwordPH":i18n("passwordPlaceHolder"),"confirmPasswordId":"confirmPasswordId","confirmPasswordPH":i18n("confirmPasswordPlaceHolder"),"phoneId":"phoneId","showPhoneRepeat":!1,"msgCodeId":"msgCodeId","msgBtnTxt":i18n(1==$scope.sendCodeType?"msgCodeTxt":"msgVoiceCodeTxt"),"msgBtnOriTxt":i18n(1==$scope.sendCodeType?"msgCodeTxt":"msgVoiceCodeTxt"),"msgCodeBtnId":"msgCodeBtnId","msgBtnDisable":!1,"submitBtnId":"submitBtnId","submitTxt":i18n("register.submit"),"chkTxt":i18n("readAgree"),"safetyDegree":i18n("safetyDegree"),"handsRegisterInfo":i18n("handsRegisterInfo"),"checked":!1,"accountFlag":1,"allowNotify":MARKET_NOTICE_DEFAULT_CHECKED,"allowNotifyShow":!1,"smsCodeMsg":"","accountPlaceHolder":i18n("register.accountPlaceHolder"),"passwordPlaceHolder":i18n("register.passwordPlaceHolder"),"confirmPasswordPlaceHolder":i18n("register.confirmPasswordPlaceHolder"),"phonePlaceHolder":i18n("register.phonePlaceHolder"),"emailPlaceHolder":i18n("register.emailPlaceHolder"),"msgCodePlaceHolder":i18n(1==$scope.sendCodeType?"register.msgCodePlaceHolder":"register.msgVoiceCodePlaceHolder"),"accountMaxLength":128,"confirmPasswordMaxLength":32,"msgCodeMaxLength":8,"phoneMaxLength":128,"oldPhoneNumber":"","code":"","phoneBack":"","geetestChallenge":"","geetestValidate":"","geetestSeccode":"","clientType":"web","needTimer":!0,"homepageUrl":iamUtils.CONFIG.homepageUrl,"phoneInputWidth":"274px","width":"380px","height":"48px","validSuc":"//res.hc-cdn.com/register/6.2.209/registerui/theme/image/right.png","validFail":"//res.hc-cdn.com/register/6.2.209/registerui/theme/image/wrong.png","validTip":"//res.hc-cdn.com/register/6.2.209/registerui/theme/image/default.png","lastWeakPasswdLvl":"","lastWeakCheckRes":!1,"sessionId":"","captchaType":GData.CONST.BOT_CHECK_TYPE_GRAPHIC,"extParams":[],"chkChange":function(){if(this.checked){$("#submitBtn").removeClass("btnDisabled");onAgreeClick(1)}else{$("#submitBtn").addClass("btnDisabled");onAgreeClick(0)}},"notifyCheck":function(){this.allowNotify?onReceivePromotionClick(1):onReceivePromotionClick(0)},"onConfirmPasswordBlur":function(testBlank){var confirmPasswordValue=$scope.model.confirmPassword;if(""==confirmPasswordValue&&!testBlank){removeErrorInfo("#confirmPasswordError");$("#"+$scope.model.confirmPasswordId).removeClass("ti-validate-error");return}if(""==confirmPasswordValue){errorWithoutMessage($scope.model.confirmPasswordId,"confirmPasswordRight");return}if($scope.model.password&&$scope.model.password!==confirmPasswordValue){addErrorInfo(i18n("passwordEqual"),"confirmPasswordId","#confirmPasswordError");upToCloudBI("comfirmPwd")}else testBlank||upToCloudBI("comfirmPwd");if(!$scope.model.password){removeErrorInfo("#confirmPasswordError");$("#"+$scope.model.confirmPasswordId).removeClass("ti-validate-error")}},"passwordValidate":{"validator":[{"rule":function(value){removeErrorInfo("#confirmPasswordError");$("#"+$scope.model.confirmPasswordId).removeClass("ti-validate-error");if(""==value||void 0==value||0===value.length)return"";if($scope.model.password&&$scope.model.password===value){showOkImg($scope.model.confirmPasswordId,"#confirmPasswordRight");return""}errorWithoutMessage($scope.model.confirmPasswordId,"confirmPasswordRight");return""}}]},"onMsgCodeBlur":function(testBlank){var pattern,msgCodeValue=$scope.model.msgCode;if(0===msgCodeValue.length&&!testBlank){removeErrorInfo("#msgCodeError");removeErrorInfo("#msgCodeRight");$("#"+$scope.model.msgCodeId).removeClass("ti-validate-error");return}if(0===msgCodeValue.length)errorWithoutMessage($scope.model.msgCodeId,"msgCodeRight");else{pattern=/^[0-9]*$/;if(!pattern.test(msgCodeValue)){errorWithoutMessage($scope.model.msgCodeId,"msgCodeRight");addErrorInfo(i18n("msgCodeErrorInfo"),$scope.model.msgCodeId,"#msgCodeError")}if(msgCodeValue.length<6){errorWithoutMessage($scope.model.msgCodeId,"msgCodeRight");addErrorInfo(iamUtils.i18nFormat(i18n("minLenTxt"),6),$scope.model.msgCodeId,"#msgCodeError")}testBlank||upToCloudBI("msgCode","",$scope.model.buildUorExtParams())}},"onMsgCodeValidate":{"validator":[{"rule":function(value){removeErrorInfo("#msgCodeError");removeErrorInfo("#msgCodeRight");if(""==value||void 0==value||0===value.length)return!1;if(-1!==value.indexOf(" "))return i18n("emptyTxt");if(!/^[0-9]*$/.test(value))return i18n("msgCodeErrorInfo");if(value.length<6)return iamUtils.i18nFormat(i18n("minLenTxt"),6);return""}}],"position":"top-left"},"onAccountBlur":function(testBlank){var retObj,accountValue=$scope.model.accountName;$("#accountTip").addClass("hide");if(0===accountValue.length&&!testBlank){removeErrorInfo("#accountError");removeErrorInfo("#accountRight");$("#"+$scope.model.accountNameId).removeClass("ti-validate-error");return}if(0===accountValue.length){errorWithoutMessage($scope.model.accountNameId,"accountRight");return}retObj=validateAccount($scope,accountValue,utils,i18n);if(retObj.result)testBlank||isKeyExisted($scope,iamHttpService,"name",accountValue,i18n("registerFailed.nameRepeat"),$scope.model.accountNameId,"#accountError",testBlank);else{addErrorInfo(retObj.errorInfo,$scope.model.accountNameId,"#accountError");errorWithoutMessage($scope.model.accountNameId,"accountRight");testBlank||onAccountCloudBi(1)}},"codeBlur":function(option){var codeId;if(!0===option)codeId=$scope.model.defaultCode;else{codeId=option.id;$scope.model.defaultCode=codeId}if(""==codeId||void 0==codeId){$("#codeSelectId").addClass("ti-validate-error");return!0}$("#codeSelectId").removeClass("ti-validate-error")},"onMsgCodeChange":function(event,value){/^[0-9a-zA-Z]*$/.test(value)?$scope.model.code=value:$scope.model.msgCode=$scope.model.code;$scope.$apply()},"onPhoneBlur":function(testBlank){var value,patternDalu,pattern;$("#areaCode").removeClass("areaCodeFocus");value=$scope.model.phone;if(!$scope.model.defaultCode)return;if(""==value||void 0==value||null==value){if(testBlank){errorWithoutMessage($scope.model.phoneId,"phoneRight");$("#areaCode").addClass("ti-validate-error");return}removeErrorInfo("#phoneRight");removeErrorInfo("#phoneError");$("#"+$scope.model.phoneId).removeClass("ti-validate-error");$("#areaCode").removeClass("ti-validate-error");return}patternDalu=/^[1][0-9]{10}$/;pattern=/^\d{0,20}$/;if("0086"==$scope.model.defaultCode){if(!patternDalu.test(value)){addErrorInfo(i18n("validPhone"),"phoneId","#phoneError");errorWithoutMessage($scope.model.phoneId,"phoneRight");$("#areaCode").addClass("ti-validate-error");testBlank||upToCloudBI("phone","",$scope.model.buildUorExtParams());return}}else if(!pattern.test(value)){errorWithoutMessage($scope.model.phoneId,"phoneRight");addErrorInfo(i18n("validPhone"),"phoneId","#phoneError");$("#areaCode").addClass("ti-validate-error");testBlank||upToCloudBI("phone","",$scope.model.buildUorExtParams());return}if("block"===$("#phoneOverLimitInfo").css("display")){$("#areaCode").addClass("ti-validate-error");errorWithoutMessage($scope.model.phoneId,"phoneRight")}testBlank||upToCloudBI("phone","",$scope.model.buildUorExtParams())},"onPhoneFocus":function(){$("#areaCode").addClass("areaCodeFocus")},"loginInNow":function(){var nextUrl,paramsSend="";$scope.isUniRegister&&(paramsSend="?unidLogin=true");Object.keys(getUrlParams()).forEach(function(key){var value=getUrlParams()[key];value&&(paramsSend+=paramsSend?"&"+key+"="+encodeURIComponent(value):"?"+key+"="+encodeURIComponent(value))});nextUrl=$scope.url.login+paramsSend;window.parent.location=nextUrl},"mask":"000 0000 0000","msgMask":"000000","onPhoneValidate":{"validator":[{"rule":function(value){removeErrorInfo("#phoneError");$("#areaCode").removeClass("ti-validate-error");$("#phoneId").removeClass("ti-validate-error");if(""==value||void 0==value||0===value.length)return"";if(-1!==value.indexOf(" "))return i18n("emptyTxt");return""}}]},"onPhoneChange":function(){document.getElementById("phoneOverLimitInfo").style.display="none";document.getElementById("phoneRepeatInfo").style.display="none";if(void 0==$scope.model.accountName||null==$scope.model.accountName||""==$scope.model.accountName){$scope.model.showAccountName=!1;$scope.model.passwordTip.content=passwordTipContent();$("#companyAccountName").hide()}11===$scope.model.phone.length&&checkPhoneExist()},"openMessage":function(messageType,messageTip,messageTitle){var instance=tiMessage.open({"type":messageType,"title":messageTitle,"closeable":!0,"elementId":"openMessage","modalClass":"messageClass","okBtn":{"show":!0,"text":i18n("btnTxtOK"),"disable":!1,"focused":!0,"click":function(){instance.close()}},"cancelBtn":!1,"content":messageTip})},"onPasswordFocus":function(event){$("#pwdTip").removeClass("hide");$("#pwdTip").show();removeErrorInfo("#passwordError");removeErrorInfo("#passwordRight");document.getElementById("fieldConfirmPassword").style.marginTop="12px"},"onPasswdChange":function(value){var password,level;$scope.model.password=$scope.model.password.replace(/[\u4e00-\u9fa5]/gi,"");password=$scope.model.password;if(""==password||null==password){$("#cipher-strength").removeClass();$("#cipher-strength").addClass("no-input");$("#pwdTip1").attr("class","li-item-default");$("#pwdTip2").attr("class","li-item-default");$scope.model.showAccountName&&$("#pwdTip3").attr("class","li-item-default");$("#pwdTip4").attr("class","li-item-default");$scope.isUniRegister&&$("#pwdTip5").attr("class","li-item-default");return}if($scope.isUniRegister&&password.length<8||$scope.isUniRegister&&password.length<6){$("#cipher-strength").removeClass();$("#cipher-strength").addClass("weak-input")}else{level=commUtil.getPwdStrengthLevel(password);switch(level){case"high":$("#cipher-strength").removeClass();$("#cipher-strength").addClass("strong-input");break;case"low":$("#cipher-strength").removeClass();$("#cipher-strength").addClass("weak-input");break;case"mid":$("#cipher-strength").removeClass();$("#cipher-strength").addClass("mid-input");break;default:$("#cipher-strength").removeClass();$("#cipher-strength").addClass("no-input")}}$scope.pwdValidateRealTime($scope.isUniRegister)},"onAccountChange":function(value){removeErrorInfo("#accountError");removeErrorInfo("#accountRight");$("#"+$scope.model.accountNameId).removeClass("ti-validate-error");checkAccountName(value,$scope)},"onAccountFocus":function(){setTimeout(function(){$("#accountTip").removeClass("hide");removeErrorInfo("#accountError");removeErrorInfo("#accountRight");checkAccountName($scope.model.accountName,$scope)},0)},"onPasswordBlur":function(testBlank){var retObj,retObjChar,retObjName,retObjContsBlur,i,retObjBlank,password=$scope.model.password;document.getElementById("fieldConfirmPassword").style.marginTop="2px";$("#pwdTip").addClass("hide");if(0===password.length&&!testBlank){removeErrorInfo("#passwordError");removeErrorInfo("#passwordRight");$("#"+$scope.model.passwordId).removeClass("ti-validate-error");return}retObj=validatePasswdPolicy(password,securityPolicy);if("not-blank"===retObj.cases){errorWithoutMessage($scope.model.passwordId,"passwordRight");testBlank||onPasswordCloudBi(1);return}if($scope.model.confirmPassword&&password==$scope.model.confirmPassword){$("#"+$scope.model.confirmPasswordId).removeClass("ti-validate-error");removeErrorInfo("#confirmPasswordError")}else if($scope.model.confirmPassword){$("#"+$scope.model.confirmPasswordId).addClass("ti-validate-error");addErrorInfo(i18n("passwordEqual"),"confirmPasswordId","#confirmPasswordError")}if("min-len"===retObj.cases||"max-len"===retObj.cases){errorWithoutMessage($scope.model.passwordId,"passwordRight");addErrorInfo(i18n("pwdInvalid"),$scope.model.passwordId,"#passwordError");testBlank||onPasswordCloudBi(1);return}retObjChar=validatePasswdChar(password);if(!retObjChar.result){errorWithoutMessage($scope.model.passwordId,"passwordRight");addErrorInfo(i18n("pwdInvalid"),$scope.model.passwordId,"#passwordError");testBlank||onPasswordCloudBi(1);return}retObjName=validatePasswdName(password,$scope.model.accountName);if(!retObjName.result){errorWithoutMessage($scope.model.passwordId,"passwordRight");addErrorInfo(i18n("pwdInvalid"),$scope.model.passwordId,"#passwordError");testBlank||onPasswordCloudBi(2);return}retObjContsBlur=validatePasswdConts(password,$scope);if(!retObjContsBlur.result){$("#password").show();$("#confirmPassword").show();errorWithoutMessage($scope.model.passwordId,"passwordRight");addErrorInfo(i18n("pwdcantContsPhone"),$scope.model.passwordId,"#passwordError");testBlank||onPasswordCloudBi(3);return}for(i=0;i<weak_test.length;i++)if(password==window.atob(weak_test[i])){$scope.model.lastWeakPasswdLvl="low";if(0!==password.length){addErrorInfo(i18n("pwdWeak"),$scope.model.passwordId,"#passwordError");errorWithoutMessage($scope.model.passwordId,"passwordRight")}testBlank||onPasswordCloudBi(4);return}if($scope.isUniRegister){retObjBlank=validatePasswdBlank(password);if("not-blank"===retObjBlank.cases){errorWithoutMessage($scope.model.passwordId,"passwordRight");addErrorInfo(i18n("pwdInvalid"),$scope.model.passwordId,"#passwordError");testBlank||onPasswordCloudBi(1);return}testBlank||checkConfidential($scope,iamHttpService,password);if(testBlank&&$scope.model.lastWeakCheckRes){addErrorInfo(i18n("pwdWeak"),$scope.model.passwordId,"#passwordError");errorWithoutMessage($scope.model.passwordId,"passwordRight");return}}else testBlank||checkConfidential($scope,iamHttpService,password);removeErrorInfo("#passwordError");removeErrorInfo("#passwordRight");showOkImg($scope.model.passwordId,"#passwordRight");testBlank||onPasswordCloudBi();setTimeout(function(){$("#pwdTip1").hasClass("li-item-wrong")||$("#pwdTip2").hasClass("li-item-wrong")||$("#pwdTip3").hasClass("li-item-wrong")||$("#pwdTip4").hasClass("li-item-wrong")||$("#pwdTip").hide()},50)},"passwordTip":{"content":passwordTipContent(),"position":"bottom","triggerEvent":"focus","hideEffect":{"duration":100},"showEffect":{"duration":100},"maxWidth":"320px;","customClass":"passwordTipClass"}};$scope.pwdValidateRealTime=function(isUniRegister){var pwd=$scope.model.password,phone=$scope.model.phone,accountName=$scope.model.accountName;if(""==pwd||null==pwd||0===pwd.length){$("#pwdTip1").attr("class","li-item-default");$("#pwdTip2").attr("class","li-item-default");$scope.model.showAccountName&&$("#pwdTip3").attr("class","li-item-default");$("#pwdTip4").attr("class","li-item-default");return}pwd.length>0&&!isUniRegister&&pwd.length<6||isUniRegister&&pwd.length<8||pwd.length>32?$("#pwdTip1").attr("class","li-item-wrong"):$("#pwdTip1").attr("class","li-item-right");changePwd(pwd,isUniRegister)?$("#pwdTip2").attr("class","li-item-right"):$("#pwdTip2").attr("class","li-item-wrong");$scope.model.showAccountName&&(!accountName||pwd.toLowerCase()!==accountName.toLowerCase()&&pwd.toLowerCase()!==accountName.split("").reverse().join("").toLowerCase()?$("#pwdTip3").attr("class","li-item-right"):$("#pwdTip3").attr("class","li-item-wrong"));phone&&-1!==pwd.indexOf(phone)?$("#pwdTip4").attr("class","li-item-wrong"):$("#pwdTip4").attr("class","li-item-right");isUniRegister&&(pwd.length!==pwd.trim().length||pwd.indexOf(" ")>=0?$("#pwdTip5").attr("class","li-item-wrong"):$("#pwdTip5").attr("class","li-item-right"))};$scope.model.passwordTipContentWithName=function(){passwordTipContentWithName()};$scope.model.allowNotifyShow=MarketNoticeSwitch;getRegionCode();$scope.defaultSignEntityForExternalUser="2821"===CbcHttpService.queryConfigItem("CSBCustomerMgrService","config-system","defaultSignEntityForExternalUser","2821");$scope.model.buildUorExtParams=function(){return buildUorExtParams($scope.model.phone,$scope.model.defaultCode,"","CN")};$scope.model.onMsgCodeBtnClick=function(){if($("#msgBtn").hasClass("msgBtnDisabled"))return!1;if($("#phoneId").hasClass("ti-validate-error")){remindErrorInfo("#phoneId");return!1}$scope.model.onPhoneBlur(1);if($("#phoneId").hasClass("ti-validate-error"))return!1;var uorExtParams=$scope.model.buildUorExtParams();onMsgCodeSend(1,"",uorExtParams);$("#msgBtn").addClass("msgBtnDisabled");iamHttpService.post({"url":"/registerui/needGraphicCode","params":{"scene":"register"}}).then(function(data){data.needVerify?onMsgCodeBtnClick($scope,tiModal):sendMsg(null,$scope)},function(){sendMsg(null,$scope)});return!0};$scope.model.sendMsgCode=function(){$("#msgBtn").addClass("msgBtnDisabled");sendMsg(null,$scope)};$scope.model.checkPhoneOrEmail=function(){if($("#msgBtn").hasClass("msgBtnDisabled"))return!1;if($("#phoneId").hasClass("ti-validate-error")){remindErrorInfo("#phoneId");remindErrorInfo("#areaCode");return!1}$scope.model.onPhoneBlur(1);if($("#phoneId").hasClass("ti-validate-error"))return!1;return!0};$scope.cancelBtnClick=function(){try{var dataValue={"messageType":"activity_iframe","function":{"name":"closeIframe"}};window.parent.postMessage(dataValue,"*")}catch(e){$scope.model.openMessage("error",i18n("closeWindowByHand"),i18n("errorTitle"))}};$scope.repeatPhoneLogin=function(){var urlServiseParam,nextUrl;onRemindLoginClick(0);urlServiseParam=iamUtils.getUrlParams().service;nextUrl=$scope.url.login+"?locale="+window.language+"&userInfoType=mobile&countryCode=0086&mobile="+$scope.model.phone;$scope.isUniRegister&&(nextUrl+="&unidLogin=true");urlServiseParam&&(nextUrl=nextUrl+"&service="+encodeURIComponent(urlServiseParam));window.parent.location=nextUrl};$scope.model.onSubmitClick=function(){if($scope.isComboBoxSelect){$scope.isComboBoxSelect=!1;return}onSubmitBtnClick($scope,iamHttpService)};$scope.sendVerifyCode=function(){commUtil.sendVerifyCode($scope)};$scope.geetestPassCallback=function(){onGeetestResult("success",$scope.model.buildUorExtParams());$scope.model.sendMsgCode()};$scope.geetestFailCallback=function(){onGeetestResult("fail",$scope.model.buildUorExtParams());$("#msgBtn").removeClass("msgBtnDisabled")};setTimeout(function(){initPMP();iamUtils.getUrlParams().preload||initialCloudBI();CbcHttpService.initGeeTest($scope);addPageView4CloudBI("/register");autoEventTracking();buildHeight()},500);setTimeout(function(){var url,urlsplit,urlroutername,topdomain,localhostdomain;try{url=getParentUrl();urlsplit=url?url.split("/"):"";urlroutername=urlsplit?urlsplit[2]:"";topdomain=urlroutername?urlroutername.split(".").slice(-2).join("."):"";localhostdomain=window.location.host.split(".").slice(-2).join(".");topdomain!=localhostdomain&&(top.location.href="/registerui/cn/register.html")}catch(e){}},0)}function checkConfidential($scope,iamHttpService,value){iamHttpService.post({"url":"/registerui/rest/cbc/cbccustomerregservice/v1/account/check_identity","contentType":"application/json; charset=UTF-8","params":JSON.stringify({"identityType":$scope.isUniRegister?"CONFIDENTIAL":"PASSWORD","identityValue":value,"scenceType":"register_portal","accountType":$scope.isUniRegister?"UNIPORTAL":"","areaCode":"CN","clientInfo":{"devId":cookieOp.get_cookie("cbc-sid")?cookieOp.get_cookie("cbc-sid"):"","hwMeta":$("#hwmeta").val()?$("#hwmeta").val():""}})}).then(function(data){window.hwcap&&window.hwcap.reload();if(data&&"false"===data.canUse){$scope.model.lastWeakPasswdLvl="low";$scope.model.lastWeakCheckRes=!0;$("#cipher-strength").removeClass();$("#cipher-strength").addClass("weak-input");addErrorInfo(i18n("pwdWeak"),$scope.model.passwordId,"#passwordError");errorWithoutMessage($scope.model.passwordId,"passwordRight");onPasswordCloudBi(4);return}$scope.model.lastWeakCheckRes=!1;return},function(){$scope.model.lastWeakCheckRes=!1;return})}function errorWithoutMessage(txtFielId,errorInfoid){var imgSrc,imgDom;removeErrorInfo("#"+errorInfoid);"INPUT"===$("#"+txtFielId)[0].tagName?$("#"+txtFielId).addClass("ti-validate-error"):$("#"+txtFielId+" input").addClass("ti-validate-error");imgSrc="//res.hc-cdn.com/register/6.2.209/registerui/theme/image/wrong.png";imgDom='<img style="margin-top: 0px;" src="'+imgSrc+'"/>';$("#"+errorInfoid).html(imgDom)}function onSubmitBtnClick($scope,iamHttpService){if($("#submitBtn").hasClass("btnDisabled")||!$scope.model.checked)return;if(hasErrorInfo($scope))return;$("#submitBtn").addClass("btnDisabled");$("#smsCodeMsg").hide();registerUser($scope,iamHttpService)}function registerUser($scope,iamHttpService){var uorParams,regUrl;beginRegisterCloudBi(1);uorParams=buildUorExtParams($scope.model.phone,$scope.model.defaultCode,"","CN");regUrl="/registerui/rest/cbc/cbccustomerregservice/v1/account/portal_register";$scope.isUniRegister&&(regUrl="/registerui/rest/cbc/cbccustomerregservice/v1/account/uni_register");iamHttpService.post({"url":regUrl,"contentType":"application/json; charset=utf-8","dataType":"json","params":JSON.stringify({"domainNameCreateMode":$scope.model.showAccountName?GData.CONST.CREATE_NAME_BY_CLIENT:GData.CONST.CREATE_NAME_BY_BACKEND,"password":$scope.model.password,"domainName":$scope.model.accountName,"pwdLevel":iamUtils.getPwdStrengthLevel($scope.model.password),"mobilePhone":$scope.model.phone,"countryCode":$scope.model.defaultCode,"fromUser":iamUtils.getUrlParams().fromuser,"referrerAlias":commUtil.getFromacct(),"chanelId":getChannelFromVal(cookieOp,iamUtils),"authenticode":$scope.model.msgCode,"authenticodeType":1,"clientInfo":{"devId":cookieOp.get_cookie("cbc-sid")?cookieOp.get_cookie("cbc-sid"):"","hwMeta":$("#hwmeta").val()?$("#hwmeta").val():""},"allowNotify":$scope.model.allowNotifyShow?$scope.model.allowNotify:"true","extParams":$scope.model.extParams}),"headers":{"X-Language":window.language}}).then(function(data){var nextUrl,atValue,paramsSend;onSubmitStep1(200,data.domainId,data.expireTime,"",uorParams);sessionStorage.setItem("AccountName",data.domainName);sessionStorage.setItem("DomainId",data.domainId);sessionStorage.setItem("UserMobile",maskMobile($scope.model.phone,$scope.model.defaultCode));sessionStorage.setItem("registerNum",data.registerNum?data.registerNum:0);sessionStorage.setItem("uorExtParams",$scope.model.buildUorExtParams());atValue=iamUtils.getUrlParams().at;paramsSend="";Object.keys(getUrlParams()).forEach(function(key){var value=getUrlParams()[key];value&&(paramsSend+="&"+key+"="+encodeURIComponent(value))});if("lottery"===atValue)nextUrl="/registerui/cn/iframe/regsuc.html?locale="+window.language+"&ticket="+data.autoLoginTicket+paramsSend+"&isreg=y";else{if("free"!==atValue&&"promotion"!==atValue){nextUrl="/registerui/cn/regsuc.html?locale="+window.language+"&ticket="+data.autoLoginTicket+paramsSend;window.parent.location=nextUrl;return}nextUrl=$scope.url.usercenter.realName_activity_12+paramsSend+"&isreg=y";send2CloudBI(buildEventCategory(),"click",i18n("realName"),"");data.autoLoginTicket&&(nextUrl=$scope.url.auto_login+"?idp="+GData.CONFIG.IDP+"&service="+encodeURIComponent(nextUrl)+"&ticket="+data.autoLoginTicket)}setTimeout(function(){window.location.href=nextUrl},0)},function(err){var msgMap,error_code=err&&err.responseJSON&&err.responseJSON.error_code,http_code=err&&err.status&&parseInt(err.status);onSubmitStep1(error_code,err.domainId,err.expireTime,"",uorParams);msgMap={"CBC.7151":i18n("verifyCode.invalid"),"CBC.7152":i18n("verifyCode.error"),"CBC.0100":i18n("input.invalid"),"CBC.7196":i18n("ipBlackList"),"CBC.7197":i18n("ipFrequencyLimit"),"CBC.7198":i18n("deviceLimit"),"CBC.7199":i18n("ipBlackList"),"CBC.7239":i18n("emailValid"),"CBC.7250":i18n("mobileValid"),"CBC.7156":i18n("verifyCode.usernameRepeat"),"CBC.7184":i18n("verifyCode.emailExist"),"CBC.7185":i18n("verifyCode.phoneExist"),"CBC.7228":i18n("pwdWeak"),"CBC.7209":i18n("verifyCode.phoneOverLimit")};429==http_code?$scope.model.openMessage("error",i18n("registerFailed.flowControled"),i18n("errorTitle")):503==http_code?$scope.model.openMessage("error",i18n(error_code&&i18n(error_code)?error_code:"registerFailed"),i18n("errorTitle")):$scope.model.openMessage("error",msgMap[error_code]||i18n("registerFailed"),i18n("errorTitle"));$.inArray(error_code,["CBC.7151","CBC.7156","CBC.7184","CBC.7185","CBC.7209"])>-1&&($scope.model.needTimer=!1);registerFail($scope)})}function registerFail($scope){$("#submitBtn").removeClass("btnDisabled");window.hwcap&&window.hwcap.reload();$scope.$apply()}function onMsgCodeBtnClick($scope,tiModal){function okHandler(verifyCode){if($scope.model.isOkDisabled)return;$scope.model.isOkDisabled=!0;setTimeout(function(){$("#smsCodeMsg").hide();sendMsg(verifyCode,$scope)},200)}function cancleHandler(){$("#msgBtn").removeClass("msgBtnDisabled")}var modalObject={"isMobile":!1,
"okCallback":okHandler,"cancleCallback":cancleHandler};tiModal.open({"templateUrl":"//res.hc-cdn.com/register/6.2.209/registerui/base/widgets/verifyWindow/verifyWindow.html","controller":verifyWindow,"resolve":{"items":modalObject}});$scope.model.isOkDisabled=!1}function sendMsg(graphicCode,$scope){window.hwcap&&window.hwcap.reload();var sessionId=$scope.model.sessionId;void 0!==sessionId&&sessionId||(sessionId=(new Date).getTime());iamHttpService.post({"url":"/registerui/rest/cbc/cbccustomerregservice/v1/util/send_verify_code","async":!1,"contentType":"application/json; charset=utf-8","dataType":"json","params":JSON.stringify({"sessionId":sessionId,"type":$scope.sendCodeType,"graphicCode":graphicCode,"countryCode":$scope.model.defaultCode,"mobilePhone":$scope.model.phone,"captchaType":$scope.model.captchaType,"scenceType":"register_portal","areaCode":"CN","accountType":$scope.isUniRegister?"UNIPORTAL":"","geeTestVerifyInfo":"GEE_TEST"!==$scope.model.captchaType?void 0:{"geetestChallenge":$scope.model.geetestChallenge,"geetestValidate":$scope.model.geetestValidate,"geetestSeccode":$scope.model.geetestSeccode},"clientInfo":{"devId":cookieOp.get_cookie("cbc-sid")?cookieOp.get_cookie("cbc-sid"):"","hwMeta":$("#hwmeta").val()?$("#hwmeta").val():""}}),"headers":{"X-Language":window.language}}).then(function(data){onGeetestCloudBi(data.error_code);window.hwcap&&window.hwcap.reload();$scope.model.needTimer=!0;msgCodeBtnStatusHandler($scope,iamUtils,i18n)},function(err){var error_code=err&&err.responseJSON&&err.responseJSON.error_code;onGeetestCloudBi(error_code);if("CBC.7241"===error_code)$scope.model.openMessage("error",i18n("GeetestVerifyCodeFailed"),i18n("errorTitle"));else if("CBC.7248"===error_code)$scope.model.openMessage("error",i18n("GrapVerifyCodeFailed"),i18n("errorTitle"));else if("CBC.7196"===error_code||"CBC.7199"===error_code)$scope.model.openMessage("error",i18n("sendVCIpBlackList"),i18n("errorTitle"));else if("CBC.7197"===error_code)$scope.model.openMessage("error",i18n("sendVCIpFrequencyLimit"),i18n("errorTitle"));else if("CBC.7198"===error_code)$scope.model.openMessage("error",i18n("sendVCDeviceLimit"),i18n("errorTitle"));else if("CBC.7209"===error_code){$("#areaCode").addClass("ti-validate-error");errorWithoutMessage($scope.model.phoneId,"phoneRight");document.getElementById("phoneOverLimitInfo").style.display="block"}else if("CBC.7185"===error_code){$("#areaCode").addClass("ti-validate-error");errorWithoutMessage($scope.model.phoneId,"phoneRight")}else"CBC.7239"===error_code?$scope.model.openMessage("error",i18n("emailValid"),i18n("errorTitle")):"CBC.7250"===error_code?$scope.model.openMessage("error",i18n("mobileValid"),i18n("errorTitle")):$scope.model.openMessage("error",i18n("verifyCode.sendFailed"),i18n("errorTitle"));$("#msgBtn").removeClass("msgBtnDisabled")})}function addErrorInfo(errorTxt,txtFielId,errorInfoid,isCodeSelect){var imgSrc,errorDomFragment;-1!==window.location.href.indexOf("registercontrast.html")&&(errorInfoid+="Tip");imgSrc="//res.hc-cdn.com/register/6.2.209/registerui/theme/image/verifycode_valid.png";errorDomFragment='<img style="vertical-align: middle" src="'+imgSrc+'"><span style="vertical-align: middle;margin-top: 0">'+errorTxt+"</span>";if(errorDomFragment.replace(/\//gi,"")===$(errorInfoid).html().replace(/\//gi,""))return;$(errorInfoid)[0].childNodes.length>0&&removeErrorInfo(errorInfoid);isCodeSelect?$("div#"+txtFielId+" div.tiny-combobox-container").addClass("ti-validate-error"):"INPUT"===$("#"+txtFielId)[0].tagName?$("#"+txtFielId).addClass("ti-validate-error"):$("#"+txtFielId+" input").addClass("ti-validate-error");$(errorInfoid).html(errorDomFragment)}function remindErrorInfo(infoid){setTimeout(function(){$(infoid).removeClass("ti-validate-error")},200);setTimeout(function(){$(infoid).addClass("ti-validate-error")},400);setTimeout(function(){$(infoid).removeClass("ti-validate-error")},600);setTimeout(function(){$(infoid).addClass("ti-validate-error")},800)}function hasErrorInfo($scope){var inputIds,inputIndex;$scope.model.codeBlur(!0);$("#phoneId").hasClass("ti-validate-error")||$scope.model.onPhoneBlur(1);$scope.model.onMsgCodeBlur(1);$scope.model.showAccountName&&$scope.model.onAccountBlur(1);$scope.model.onPasswordBlur(1);$scope.model.onConfirmPasswordBlur(1);inputIds=["#phoneId","#msgCodeId","#accountNameId","#passwordId","#confirmPasswordId"];for(inputIndex in inputIds)if($(inputIds[inputIndex]).hasClass("ti-validate-error")){"#phoneId"===inputIds[inputIndex]&&remindErrorInfo("#areaCode");remindErrorInfo(inputIds[inputIndex]);return!0}return!1}function maskMobile(mobile,code){var countryCode="+"+code.substring(2)+" ";-1!==mobile.indexOf("-")&&(mobile=countryCode+mobile.substring(mobile.indexOf("-")+1));if(""===mobile||void 0===mobile)return"";if(mobile.length>7)return countryCode+mobile.substr(0,3)+"******"+mobile.substr(9,mobile.length);if(mobile.length>3)return countryCode+mobile.substr(0,3)+"******";return countryCode+mobile+"****"}function showOkImg(txtFielId,infoid){removeErrorInfo(infoid);$("#"+txtFielId).removeClass("ti-validate-error")}function validatePasswdName(value,userName){var retObj={"result":!0,"errorInfo":""};if(userName&&(value.toLowerCase()===userName.toLowerCase()||value.toLowerCase()===userName.split("").reverse().join("").toLowerCase())){retObj.result=!1;retObj.errorInfo=i18n("pwdNotUsernameOrInvert")}return retObj}function removeErrorInfo(id){if($(id)[0])for(;$(id)[0].hasChildNodes();)$(id)[0].removeChild($(id)[0].firstChild);id+="Tip";if($(id)[0])for(;$(id)[0].hasChildNodes();)$(id)[0].removeChild($(id)[0].firstChild)}function validatePasswdPolicy(value,securityPolicy){var retObj=iamUtils.directValidator.password(value,securityPolicy);if(!retObj.result)return retObj;return retObj}function validatePasswdChar(value){var retObj={"result":!1,"errorInfo":i18n("passwordChars")};if(new RegExp("[一-龥]+").test(value))return retObj;if("high"!==utils.getPwdStrengthLevel(value)&&"mid"!==utils.getPwdStrengthLevel(value))return retObj;retObj.result=!0;retObj.errorInfo="";return retObj}function validatePasswdBlank(value){var retObj={"result":!1,"errorInfo":i18n("pwdNotBeginAndEndBlank")};if(value.length!==value.trim().length)return retObj;retObj.result=!0;retObj.errorInfo="";return retObj}function getParentUrl(){var url=null;if(parent!==window)try{url=parent.location.href}catch(e){url=document.referrer}return url}function validatePasswdConts(value,$scope){var retObj={"result":!1,"errorInfo":i18n("pwdNotContsMobile")};if($scope.model.phone&&-1!==value.toLowerCase().indexOf($scope.model.phone.toLowerCase()))return retObj;retObj.result=!0;retObj.errorInfo="";return retObj}function errorWithoutMessage(txtFielId,errorInfoid){removeErrorInfo("#"+errorInfoid);"INPUT"===$("#"+txtFielId)[0].tagName?$("#"+txtFielId).addClass("ti-validate-error"):$("#"+txtFielId+" input").addClass("ti-validate-error")}CustomerRegisterController.$injector=["$scope","securityPolicy","$compile","tiValid","tiMessage","tiModal","tiTipService"];var loginModule=angular.module("authui.config");loginModule.tinyController("authui.register.ctrl",CustomerRegisterController);return loginModule});